;===========================================================
;파일명: STOCK.ERB
;주식 관련 정보 처리
;===========================================================
;주식시장 메인
;-----------------------------------------------------------
@STOCK_MARKET
#DIM STOCK_ID
#DIM PRICE_CODE
PRICE_CODE = STOCK_ID - MINIMUM_STOCKNO

DRAWLINEFORM =
;CALL SHOW_STOCKSTORAGE
PRINTL 
$LOOP_STOCK
CALL SHOW_STOCKMARKET
INPUT
STOCK_ID = RESULT
SELECTCASE STOCK_ID
    CASE IS < MINIMUM_STOCKNO
        PRINTW 해당하는 종목코드가 없습니다.
        GOTO LOOP_STOCK
    CASE 999
        RETURN 0
    CASE IS > MAXIMUM_STOCKNO
        PRINTW 해당하는 종목코드가 없습니다.
        GOTO LOOP_STOCK
    CASEELSE
        PRINTFORMC TICKER: %ITEMNAME:STOCK_ID%
        IF STOCK_BOUGHT_PRICE:PRICE_CODE > 0
            MONEYSTR STOCK_BOUGHT_PRICE:PRICE_CODE
            PRINTFORMC 평균단가: %RESULTS%
        ENDIF
        PRINTFORMLC 소유 수: {ITEM:STOCK_ID}
        CALL STOCK_TRADE(STOCK_ID)
        GOTO LOOP_STOCK
ENDSELECT

;-----------------------------------------------------------
;주식 가격 처리
;ARG = STOCK_ID
;-----------------------------------------------------------
@SET_STOCKPRICE(ARG)
#FUNCTION
LOCAL = STOCK_PRICE:ARG
LOCAL += (RAND(1,1000000) - LOCAL/51 ) / 5
RETURNF LOCAL

;-----------------------------------------------------------
;주식 가격 기본값 처리
;-----------------------------------------------------------
@UPDATE_STOCK
#DIM STOCK_ID
#DIM PRICE_CODE
PRICE_CODE = STOCK_ID - MINIMUM_STOCKNO
MAXIMUM_STOCKNO = MINIMUM_STOCKNO + STOCK_IN_MARKET - 1

FOR STOCK_ID, MINIMUM_STOCKNO, MAXIMUM_STOCKNO
    STOCK_PRICE:PRICE_CODE = MAX(STOCK_PRICE:PRICE_CODE, ITEMPRICE:STOCK_ID)
NEXT

;-----------------------------------------------------------
;주식시장 현황 표시
;-----------------------------------------------------------
@SHOW_STOCKMARKET
#DIM STOCK_ID
#DIM PRICE_CODE
PRICE_CODE = STOCK_ID - MINIMUM_STOCKNO

DRAWLINEFORM =
FOR STOCK_ID, MINIMUM_STOCKNO, MAXIMUM_STOCKNO
    MONEYSTR STOCK_PRICE:PRICE_CODE
    PRINTL
    PRINTFORM [{STOCK_ID}] 
    PRINTFORMC %STR:STOCK_ID, 25, LEFT%
    PRINTFORMC 현재가: %RESULTS, 10%
    SIF ITEM:STOCK_ID > 0
        PRINTFORMC 잔고: {ITEM:STOCK_ID, 5} 주
NEXT
PRINTL
DRAWLINE
PRINTFORML [999] 돌아가기
DRAWLINEFORM =

;-----------------------------------------------------------
;주식 잔고 표시
;-----------------------------------------------------------
@SHOW_STOCKSTORAGE
PRINTW 미실장입니다.

;-----------------------------------------------------------
;주식 거래 함수
;ARG = STOCK_ID
;-----------------------------------------------------------
@STOCK_TRADE(ARG)
PRINTW 미실장입니다.
